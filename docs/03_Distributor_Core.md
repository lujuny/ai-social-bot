# 多平台分发调度模块

#### 1. 模块概述

**目标**：解决“发出去”的问题。自动化上传内容到各大社媒平台。 **输入**：待发布的草稿 (`content_drafts`). **输出**：发布记录 (包含各平台的 Post ID)。

#### 2. 核心功能

- **Cookie 维持**：自动检测 Cookie 有效性，失效报警或自动刷新。
- **模拟上传**：还原人类操作路径（点击发布 -> 上传图片 -> 填写标题 -> 点击发布）。
- **错峰发布**：根据各平台用户活跃时间段（如早8点、晚10点）设置定时任务。

#### 3. 技术方案

- **库**：`playwright` (核心), `APScheduler` (定时任务).
- **难点处理**：
  - **指纹浏览器**：使用 `playwright-stealth` 插件隐藏自动化特征。
  - **异常处理**：遇到弹窗、验证码时挂起并通知人工介入。

#### 4. 数据结构 (Table: `publish_logs`)

| **字段名**       | **类型** | **描述**                            |
| ---------------- | -------- | ----------------------------------- |
| `id`             | UUID     | 主键                                |
| `draft_id`       | UUID     | 关联的草稿ID                        |
| `platform`       | Varchar  | 目标平台 (xhs, dy, twitter)         |
| `remote_post_id` | Varchar  | 平台返回的帖子ID/URL (用于后续监控) |
| `publish_time`   | Datetime | 实际发布时间                        |
| `account_id`     | Varchar  | 使用的账号标识                      |